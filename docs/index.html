<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/go.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked-highlight/lib/index.umd.js"></script>
    <script>hljs.highlightAll();</script>
    <title>My App</title>
    <style>
        * {
            margin: 0;
            box-sizing: border-box;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: bold;
        }

        h3 {
            font-size: 1.5rem;
        }

        ul,
        p {
            font-size: 1.8rem;
        }

        code {
            font-size: 1.2rem;
        }

        .common {
            padding: 2rem;
        }

        .one {
            background-color: white;
            position: fixed;
            left: 0;
            top: 0;
            width: 60vw;
            height: 100vh;
            z-index: 1;
        }

        .two {
            background-color: #0c1116;
            /* background-color: lightgreen; */
            position: fixed;
            right: 0;
            top: 0;
            width: 40vw;
            height: 100vh;
            z-index: 2;
            overflow-y: scroll;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .two h3 {
            font-size: 1.2rem;
            text-align: left;
        }

        .two h3:before {
            content: "üìù";
            margin-right: 0.5rem;
        }

        .three {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 60vw;
            height: 60vh;
            z-index: 1;
            display: flex;
            justify-content: center;
            overflow-y: scroll;
        }

        .three p {
            text-align: center;
            width: 100%;
        }

        .three img {
            max-width: 80%;
        }

        .four {
            background-color: teal;
            color: white;
            position: fixed;
            bottom: 0;
            left: 0;
            width: 60vw;
            height: 35vh;
            z-index: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .fade {
            /* „Éï„Çß„Éº„ÉâÁî® */
            opacity: 0;
            pointer-events: none;
            transition: opacity 1000ms ease;
        }


        /* Ë°®Á§∫Áä∂ÊÖã */
        .two.is-open,
        .three.is-open,
        .four.is-open {
            opacity: 1;
            pointer-events: auto;
        }

        .controller {
            position: fixed;
            top: 10px;
            left: 10px;
            width: 100vw;
            z-index: 100;
        }
    </style>
</head>

<body>
    <div class="controller">
        <input type="text" id="url" placeholder="URL">
        <button id="load">Load</button>
    </div>
    <div class="common one" contenteditable="true"></div>
    <div class="common two fade" contenteditable="true" ondblclick="toggle(this,  {width: '100vw', height: '100vh'}, {width: '40vw', height: '100vh'})"></div>
    <div class="common three fade" ondblclick="toggle(this,  {width: '100vw', height: '100vh'}, {width: '60vw', height: '60vh'})"></div>
    <div class="common four fade" contenteditable="true"></div>
    <script>

        window.addEventListener('keydown', function (e) {
            if (e.altKey) {
                e.preventDefault();
                if (e.code === 'Digit0' || e.code === 'Numpad0') {
                    togglePanel(0);
                } else if (e.code === 'Digit2' || e.code === 'Numpad2') {
                    togglePanel(2);
                } else if (e.code === 'Digit3' || e.code === 'Numpad3') {
                    togglePanel(3);
                } else if (e.code === 'Digit4' || e.code === 'Numpad4') {
                    togglePanel(4);
                } else if (e.key === 'ArrowRight') {
                    console.log('ArrowRight');
                    nextPanel();
                } else if (e.code === 'KeyF') {
                    console.log('f');
                    if (document.documentElement.requestFullscreen) {
                        console.log('f2');
                        document.documentElement.requestFullscreen();
                    }
                }
            }
        });

        function togglePanel(number) {
            if (number === 0) {
                hidePanels()
            } else if (number === 2) {
                togglePanelInternal('.two');
            } else if (number === 3) {
                togglePanelInternal('.three');
            } else if (number === 4) {
                togglePanelInternal('.four');
            }
            flash();
        }

        const hidePanels = () => {
            hidePanel(document.querySelector('.two'));
            hidePanel(document.querySelector('.three'));
            hidePanel(document.querySelector('.four'));
        }

        const flash = () => {
            const common = document.querySelector('.common');
            common.style.backgroundColor = "lightyellow";
            setTimeout(() => {
                common.style.backgroundColor = '';
            }, 200);
        }

        const nextPanel = () => {
            const two = document.querySelector('.two');
            const three = document.querySelector('.three');
            const four = document.querySelector('.four');
            if (two.classList.contains('is-open')) {
                if (three.classList.contains('is-open')) {
                    if (four.classList.contains('is-open')) {
                        hidePanels();
                    } else {
                        openPanel(four);
                    }
                } else {
                    openPanel(three);
                }
            } else {
                openPanel(two);
            }
        }

        const togglePanelInternal = (panelClass) => {
            const panel = document.querySelector(panelClass);
            if (panel.classList.contains('is-open')) {
                hidePanel(panel);
            } else {
                openPanel(panel);
            }
        }
        const openPanel = (panel) => {
            panel.classList.add('is-open');
        }
        const hidePanel = (panel) => {
            panel.classList.remove('is-open');
        }

        const { markedHighlight } = window.markedHighlight;
        // marked „Å´ highlight.js „ÇíÁµÑ„ÅøËæº„ÇÄ
        marked.use(markedHighlight({
            langPrefix: 'hljs language-',
            highlight(code, lang) {¬£‚Ñ¢
                if (hljs.getLanguage(lang)) {
                    return hljs.highlight(code, { language: lang }).value;
                }
                return hljs.highlightAuto(code).value;
            }
        }));

        const loadContents = async () => {
            const urlValue = document.querySelector('#url').value
            const url = urlValue === "" ? "https://raw.githubusercontent.com/murayama333/md2slide/refs/heads/main/md/css/part1/02_css.md" : urlValue;
            const response = await fetch(url);
            const md = await response.text();
            const mdParts = md.split(/^##\s/m);

            const oneContents = marked.parse(adjustFirstLine(mdParts[0]));
            document.querySelector('.one').innerHTML = oneContents;
            const twoContents = marked.parse(adjustFirstLine(mdParts[1]));
            document.querySelector('.two').innerHTML = twoContents;
            const threeContents = marked.parse(adjustFirstLine(mdParts[2]));
            document.querySelector('.three').innerHTML = threeContents;
            const fourContents = marked.parse(adjustFirstLine(mdParts[3]));
            document.querySelector('.four').innerHTML = fourContents;
        }


        window.addEventListener('load', loadContents);
        document.querySelector('#load').addEventListener('click', loadContents);


        const adjustFirstLine = (string) => {
            if (string.startsWith("„Çµ„É≥„Éó„É´„Ç≥„Éº„Éâ\n")) {
                return string.replace("„Çµ„É≥„Éó„É´„Ç≥„Éº„Éâ\n", "");
            } else if (string.startsWith("ÂÆüË°åÁµêÊûú\n")) {
                return string.replace("ÂÆüË°åÁµêÊûú\n", "");
            } else if (string.startsWith("„Éù„Ç§„É≥„Éà")) {
                return string.replace("„Éù„Ç§„É≥„Éà", "");
            }
            return string;
        }

        function toggle(panel, size1, size2) {
            if (panel.style.width === size1.width) {
                panel.style.width = size2.width;
                panel.style.height = size2.height;
            } else {
                panel.style.width = size1.width;
                panel.style.height = size1.height;
            }

            hljs.highlightAll();
        }
    </script>
</body>

</html>